信息收集
信息收集第一步进行域名信息收集，可通过企查查等查看公司的知识产权，里面会有小程序、网站等信息
通过收集到的域名，在进行Whois查询和备案查询，获取更多的信息，比如其他域名、邮箱、地址、电话等，然后还可以根据这些进行反查，进一步获取更多的域名
第二步进行子域名收集，我一般使用的工具是OneForAll，对于收集到的子域名可以尝试获取其真实IP，原因是第一点，更加正确了解目标系统所在的网络环境和括补结构，
第二点就是有些网站的防御是建立在CDN上的，直接通过IP访问可能可以绕过防御，判断是否存在CDN可以尝试进行多点ping，如果ip不唯一，多半是使用了CDN
第三步进行端口信息收集，收集该域名还开放了哪些端口，扩大供给面
第四步进行站点信息收集，首先进行站点验活，借助工具httpx将失活的网站排除，接着进行WAF检测，对于没有WAF的网站优先进行渗透测试，因为没有WAF的网站相对于
更容易发现漏洞，接着进行站点资产收集，比如fofa、鹰图平台等收集该站点用了哪些组件，然后看是否存在历史漏洞；接着可以收集站点的目录，我一般使用dirsearch，
看有没有隐藏的目录或文件，接着进行JS信息收集，看有没有敏感信息泄露或者一些未授权的接口

OWASP Top 10 2021
1. 失效的访问控制：比如未授权就能访问一些文件导致信息泄漏，还有未授权登录后台应用，未授权访问API等。
2. 加密机制失效：表面上就是敏感信息泄漏，比如明文传输账号密码等
3. 注入：比如SQL注入、Cookie注入、UA注入等
4. 不安全设计：也就是一些逻辑漏洞
5. 安全配置错误：比如使用了默认的账号密码、多余的端口开放或者文件上传目录允许执行脚本等
6. 有缺陷或过时组件：也就是存在历史漏洞
7. 身份识别和身份验证错误：比如登录时错误的提示用户名不存在导致能爆破用户名，再加上没有验证码
或ip限制次数导致能爆破密码；还有一些认证比较脆弱或无效的，比如忘记密码功能能绕过认证进行密码重置。
或者是系统判断身份是通过uid来判断，很容易导致身份冒充。
8. 软件和数据完整性故障：比如一些系统会使用第三方库，当用户提交数据或从第三方获取数据时，缺少对数据的检验，导致的安全问题。
比如：一个系统使用第三方的数据库软件，该软件会对数据验证和完整性检查，确保数据安全，但系统可能存在缺陷或错误配置，
让攻击者修改数据库里的数据。或者是一些不安全的反序列化，反序列化了些恶习代码导致软件遭到破坏。
9. 安全日志记录和监控故障：也就是记录和监控不足，可能导致安全事件的错报或漏报。
10. ssrf（服务器端请求伪造）：程序向远程服务器发送http请求时，攻击者构造恶意请求，使程序向攻击者指定的url发送请求。

CORS配置不当
CORS漏洞是指服务端配置不当，没有配置Access-Control-Allow-Origin等字段，导致攻击者能构造恶意脚本，诱导用户点击获取敏感信息
一般存在CORS漏洞都存在CSRF漏洞

CRLF注入
CRLF注入通常是发生在用户输入直接被构造到HTTP响应中，攻击者可以在HTTP响应中插入回车换行符，以执行恶意操作和欺骗用户
测试是否存在CRLF注入一般使用\r\n
如果存在WAF可以对其进行编码绕过，比如unicode编码、url编码、哈希编码等
或者往其加入大量垃圾字符，比如+符号等
或者使用一个无效的协议执行JS代码

CSRF漏洞
CSRF也就是跨站请求伪造，是一种挟持用户在已登录的web应用上执行非本意的操作
原理就是在Cookie未过期且未退出网站的情况下访问网站，会自动携带上Cookie
对于CSRF漏洞防御一般通过Referer、Origin和CSRF Token进行防御，但如果防御逻辑不当，则可进行绕过
比如在使用Referer校验时，对于域只是简单的校验存在域的字符串，则可以通过将其作为自己域的子域进行绕过
也有的应用程序当Referer请求头不存在时将跳过验证
Origin的情况和Referer类似，当对域校验不严谨时可进行绕过
当使用token进行验证时，有的应用程序只对POST请求进行验证，可以尝试改为GET请求进行尝试绕过
有的应用程序只校验token是否存在
也有的程序token没有绑定会话，使用的是token池，那么就可以用自己的账号获取一定的token进行CSRF漏洞利用
有的token放在了cookie里，这种情况会难以利用，需要结合CRLF注入更改cookie
当然这些防御也不是绝对的安全，如果网站还存在xss漏洞，将可能导致这些防御全线溃败

HTTP请求走私
HTTP请求走私源于前后端关于消息正文大小的分歧，攻击者在自己的请求中夹带一个请求，从而影响下一个请求
请求走私的种类有四种：
第一种是Content-Length不为0的GET请求：当前端允许GET请求携带请求体，而后端不允许，则会忽略Content-Length，不进行处理，这就可能导致请求走私
第二种是请求包含2个Content-Length，当2个Content-Length值不同时，按照规范需要返回400，但有的服务器没有遵循规范，没有返回400，而是前端服务器取
第一个Content-Length，而后端服务器取第二个Content-Length，前后端取值不同时，就可能存在请求走私
第三种是请求中存在一个Content-Length，一个Transfer-Encoding，前端处理Content-Length，而后端处理Transfer-Encoding，值不同，就可能造成请求走私
第四种就是请求中有一个Content-Length，有两个Transfer-Encoding，而前后端都会处理Transfer-Encoding，可以对其中一个Transfer-Encoding的值进行乱写达成混淆
从而让前端或后端不处理Transfer-Encoding，本质上就是第二种和第三种方法
HTTP请求走私利用第一种利用就是HTTP请求头中比如User-Agent存在xss漏洞，借助HTTP请求走私能将危害扩大到其他用户而不是自有自己
第二种就是进行Web缓存投毒，比如一个网站的服务器会将一些静态资源缓存起来，下次访问从缓存中读取；那么第一个人修改包加入恶意数据，接下来的用户访问这些
资源则会加载这些恶意数据

JSON劫持
JSON劫持属于CSRF的范畴，当一个网站使用JSONP进行跨域传递敏感信息时，攻击者就能通过构造恶意的JSONP调用页面，诱导用户点击，获取用户的敏感信息
当输出的JSON没有严格定义Content-Type为application/json时，还可以通过callback输出点进行XSS
有的网站会使用Referer和token进行防御，但如果Referer对域验证不严谨，只检验是否存在指定域的字符串，则可进行绕过，有的网站当不存在Referer或者值为空时
不进行校验；如果token组成简单，容易爆破也可进行爆破绕过防御

JWT攻击
JWT攻击一般是伪造令牌、JWT信息泄露等
信息泄露就是对JWT进行解码时，其里面存在一些敏感信息
在进行伪造令牌时，第一种情况，有些开发为了方便开启了算法为None，上线了又忘记关了，则可将算法改为None进行伪造令牌
第二种情况，有的网站后端允许对称加密和非对称加密，当你获得公钥时，将非对称加密改为对称加密，可用公钥进行加密伪造令牌
第三种情况，可爆破JWT的私钥，进行令牌伪造

SQL注入
SQL注入通常发生在应用程序未能正确验证或转义用户输入的情况下，攻击者通过注入恶意的SQL语句，从而实现对数据库的非法访问和控制
SQL注入利用的第一步是找注入点，看是否可以注入，一般使用单引号和双引号，看页面是否有变化或者有没有报错信息来判断是否为注入点
第二步判断是数字型注入还是字符型注入，可以使用比如and 1=1、and 1=2来看页面的影响，如果有影响就是数字型注入，反之就是字符型注入
第三步，如果是字符型注入，就需要进行闭合，想办法进行闭合，让sql不报错
第四步就是判断sql的列数和显错位
第五步就是求库、求表、求字段、求数据；如果有回显，优先使用联合注入，如果没有回显，但有报错内容，则可以报错注入，如果都没有，但页面能判断真假，
可以使用布尔注入，三者都没有的话就尝试时间注入，也可以尝试DNS盲注，通过发送DNS请求看是否存在
当然有一些特殊的注入，比如堆叠注入，通过分号结束，然后加入一个新的sql，进行增删改
还有二次注入，恶意数据添加到数据库，被二次调用
第六步就是找后台路径
第七步就是上传getshell木马，然后连接
在这个过程中也会遇到WAF，就要进行WAF绕过，比如注释符绕过，大小写绕过，编码绕过，过滤的关键字替换等，这些就结合实际情况一个一个尝试

SSRF
SSRF也就是服务端请求伪造，是指攻击者欺骗服务器发起网络请求，可能导致对内部系统、外部服务或本地资源的未授权访问。
web服务器需要从别的服务器获取数据，比如：图片识别、图片拉取等，如果获取数据的服务器地址可控，攻击者可以通过web服务器自定义向别的服务器发出请求，
或者向内网服务器发送请求
SSRF的利用通常需要尝试多种协议来扩大危害，比如http/https、file、sftp等
如果是无回显型的就需要借助DNSlog平台来验证，如果不出网，可以通过请求响应时间判断内网资产是否存在来验证

URL跳转漏洞
URL跳转漏洞是指服务端未对传入的跳转URL变量进行检查和控制，导致攻击者诱导用户点击跳转到恶意网站
该漏洞一般存在业务完成处和用户交互处，比如注册账号，找回密码，登录登出，分享链接等
如果其存在白名单缺陷，
也可以利用正斜杠、反斜杠、问号、井号、@、其域作为自己域的子域、借助百度的多重跳、插入截断符、使用ip、ipv6、ip的8进制、十六进制转来绕过

XSS
XSS也就是跨站脚本攻击，这是一种将JS代码插入到其他用户页面中执行达到攻击目的的漏洞。
XSS漏洞有三种，分别是反射型、存储型、DOM型
反射型属于一次性攻击，攻击者将恶意代码放在链接中，目标用户点击该链接，服务器接收该请求并处理，然后将携带了XSS代码的数据发送到目标用户的浏览器，
浏览器解析该XSS代码，触发脚本，常见的地方在搜索栏处
存储型是持久型攻击，恶意代码会存储在数据库或文件中，XSS代码永久嵌入在页面中，所有访问该页面的用户都会成为受害者，常见的地方有论坛，留言、标签等
DOM型是针对JS代码的，不经过服务器进行交互，只会发生在客户端处理数据阶段。常见的地方就是对文档对象进行编辑，从而修改页面元素。
针对XSS的WAF绕过可以尝试第一种，传多个参数过去，有的服务器会将相同的参数进行拼接
第二种，进行编码绕过，比如HTML实体编码、Unicode编码、八进制、十六进制编码等
第三种，找替代字符，比如双引号过滤了，就使用单引号，单引号过滤了，就是用正斜杠或者不适用单引号；
标签过滤了就fuzz找能使用的标签，或者嵌套多个标签还绕过标签限制
第四种，大小写绕过
第五种，长度限制绕过，尝试将payload通过变量赋值拆分成多个
第六种，HTTP请求修改绕过，有的应用只检查URL，不检查POST请求时的请求体
第七种，加干扰字符，比如正斜杠、井号等
第八种，使用拼接绕过，比如，var a = alert;a(1);
第九种，利用大写的Function()().其第一个括号里的js会直接执行

XXE
XXE也就是XML外部实体注入，XXE漏洞存在于使用XML解析器的应用程序中
攻击者利用这种漏洞向应用程序发送恶意的XML输入，从而导致敏感信息泄露，服务端请求伪造等安全问题
当XXE是回显型，可以进行读取任意文件、命令执行、内网探测等操作
当XXE是不回显时，可以使用HTTP外带，将获取的结果作为URL参数发送到攻击者的服务器上，如果没办法外带则可以进行拒绝服务攻击来证明危害
常见的地方比如，DOCX文档在线预览等

中间库漏洞
中间库漏洞是指中间件程序本身存在漏洞或配置不当，导致攻击者可以利用该漏洞对系统进行攻击或获取敏感信息等安全问题
比如FastJson的反序列化漏洞，就是在解析json时，未对其进行验证，直接转换成java对象执行

信息泄露
信息泄露是指未经授权或意外情况下，敏感信息或机密信息被泄露给未经授权的人员或系统的过程
比如.git文件泄露、网站备份文件泄露等等

命令执行漏洞
命令执行漏洞通常发生在应用程序未正确验证用户提供的输入数据，导致用户提交的恶意数据被当作命令或脚本执行
在利用时需要判断操作系统，常见的就是Win和Linux了，可以使用Ping命令，当使用ping -n 产生延时时，则是Win，否则是Linux
在Win中，可以使用双引号、括号、逻辑运算符等来对WAF进行干扰
当命令执行漏洞是有回显且出网时，可以通过确认web物理路径写shell、远程下载并执行命令，比如powershell、添加账号等方式进行漏洞利用
当有回显但不出网时，主要思路就是确认web物理路径写shell
当无回显出网时，可以通过确认web物理路径写shell，利用特殊文件定位web路径，远程下载到特殊路径，然后访问该路径、进行命令执行
当无回显不出网时，主要思路也是确认web物理路径写shell、利用特殊文件定位web路径，将结果写在该路径下的txt文件并进行访问
Linux利用思路与Win差不多

文件上传漏洞
文件上传漏洞是指攻击者利用该漏洞上传恶意文件，并在服务器上执行这些恶意文件，这种漏洞通常发生在应用程序未正确验证上传文件类型、大小、内容等情况下。
对于WAF绕过，如果是前端校验，可以通过直接修改包来绕过
对于后端校验，可以尝试修改Content-Type为image/*来绕过、大小写绕过、特殊解析名绕过、截断绕过等
如果是检验内容，可以尝试在内容前添加文件头、或者分块传输
如果网站是先上传后在校验，可以利用多线程上传执行，打个时间差

文件包含漏洞
文件包含通常发生在PHP实现的应用程序中，
开发者在使用一些文件包含函数时，没有对来源进行严格审查，导致不光可以包含预先指定文件，还可以包含服务器内部的文件，导致敏感信息被读取
文件包含一般分为本地包含和远程文件包含
本地包含可以进行任意文件读取，可以通过https、php、file、zip等协议进行读取；有些日志会记录用户的输入内容，可以通过包含日志达成执行php脚本
远程包含可以文件包含攻击者服务器里的攻击脚本文本，当包含该文本会执行里面的php代码，来执行一些命令，比如创建一个php文件并写入一句话木马进行shell连接

文件读取漏洞
文件读取漏洞是指攻击者通过该漏洞来读取并执行本不应该被访问或执行的文件
检查是否有该漏洞，可以看参数是否有获取文件的，比如page=xxx.html

未授权访问漏洞
未授权访问漏洞是指攻击者可以在未经授权的情况下访问应用程序、系统或网络中的敏感资源和数据的漏洞
这种漏洞通常发生在身份验证或访问控制机制不严格或实现不完善的情况下，使得攻击者能绕过这些机制访问受保护的资源

越权漏洞
越权漏洞是指攻击者能够绕过身份验证或访问控制机制，获取未经授权或访问资源的能力。
也就是越权漏洞允许攻击者执行某些操作，而这些操作应该仅由经过授权的用户或角色执行。
越权漏洞一般分为水平越权和垂直越权。
水平越权就是同级别的用户或同一角色的不同用户之间，可以越权访问、修改、删除等非法操作
垂直越权也就是使用权限低的用户访问权限较高的用户